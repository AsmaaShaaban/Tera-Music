@model IEnumerable<MVCProJect.Models.Customer>

@{
	ViewBag.Title = "Index";
	Layout = "~/Views/Shared/_Layout.cshtml";
}
<h2>Customer</h2> 

@Html.ActionLink("Create", "create", "customer", null, new { @class = "btn btn-success" })


@*@if (!Model.Any())
{
	<p> Sorry , There is no customer yet!</p>
}
else
{*@
	<table class="table table-hover table-bordered" id="customers">
		<thead>
			<tr>
				<th>Customer Name</th>
				<th>Details</th>
				<th>Edit</th>
				<th>Delete</th>

			</tr>
		</thead>
		<tbody>
			@*@foreach (var customer in Model)
			{
				<tr>
					<td><a href="#">@customer.Name</a></td>
					<td>@Html.ActionLink("Details", "Details", "Customer", new { Id = customer.Id }, null)</td>
					<td>@Html.ActionLink("Edit", "Edit", "Customer", new { Id = customer.Id }, null)</td>
					<td>@Html.ActionLink("Delete", "Delete", "Customer", new { Id = customer.Id }, new {@class = "js-delete" , data_customer_Id= customer.Id })</td>
					<td><button class="btn-link btn js-delete" data_customer_id="@customer.Id">Delete</button></td>

				</tr>
			}*@


		</tbody>
	</table>

@*}*@
@section scripts
{
	<script>
		$(document).ready(function () {
			var table = $("#customers").DataTable({
				ajax :{
					url: "/api/Customer",
					dataSrc: ""
				},
				columns: [
					{
						data: "name",
						render: function (data, type,customer) {
							return "<a href='/Customer/Details/" + customer.id + "'>" + data + "</a>";
						}
					},
					{
						data: "membership.name"
					},
					//{
					//	data: "id",
					//	render: function (data) {
					//		return "<button class='btn btn-link' data_customer_Id=" + data + ">Details</button>";
					//	}
					//},
					{
						data: "id",
						render: function (data) {
							return "<a href= '/Customer/Edit/" + data + "'>Edit</a>";
						}
					},
					{
						data: "id",
						render: function (data) {
							return "<button class='btn btn-link js-delete' data_customer_Id=" + data + ">Delete</button>";
						}
					}
				]
				
			});
			$("#customers").on("click", ".js-delete", function () {
				var button = $(this);
				bootbox.confirm("Are You Sure to DELETE this Customer?", function (result) {
					if (result) {
						$.ajax({
							method: "DELETE",
							url: "/api/Customer/" + button.attr("data_customer_Id"),
							success: function () {
								table.row(button.parents("tr")).remove().draw();
							}
						});
					}
				});


			});
		});

	</script>
}



